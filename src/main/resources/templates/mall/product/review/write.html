<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/main.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<title>리뷰쓰기</title>
</head>
<style>
  .star_div {
    background-color:lightgray;
    height: 80px;
    text-align:center;
    font-size: 1.5em;
  }

  #content {
    width: 100%;
    height: 150px;
    resize: none;
  }
</style>
<script>
  const orderDetailNo = [[${item.orderDetailNo}]]
  const productNo =  [[${item.productNo}]]
</script>
<script>
  let productReviewStar = undefined;

  $(document).ready(function() {
    $(".star").click(function() {
      productReviewStar = $(this).attr("data-jumsu");

      $.each($(".star"), function(idx, element) {
        const $element = $(element);
        $element.removeClass("fa-star").addClass("fa-star-o");
        if($element.attr("data-jumsu")<=productReviewStar) {
          $element.removeClass("fa-star-o").addClass("fa-star");
        }
      });
    });

    $('#write').click(function() {
      if(productReviewStar==undefined) {
        alert("상품을 평가해주세요");
        return;
      }

      const productReviewContent = $('#content').val();
      const $form = $('<form>').attr('method','post').attr('action','/mall/product/review/write');
      $("<input type='hidden'>").attr('name','orderDetailNo').val(orderDetailNo).appendTo($form);
      $("<input type='hidden'>").attr('name','productNo').val(productNo).appendTo($form);
      $("<input type='hidden'>").attr('name','productReviewContent').val(productReviewContent).appendTo($form);
      $("<input type='hidden'>").attr('name','productReviewStar').val(productReviewStar).appendTo($form);
      $form.appendTo($('body')).submit();
    })
  })
</script>
<body>
<header th:replace="~{/fragment/header.html}">
</header>
<nav th:replace="~{/fragment/nav.html}">
</nav>
<main>
  <aside th:replace="~{/fragment/aside.html}">
  </aside>
  <section>
    <h1>리뷰쓰기 페이지</h1>
    <hr>
    <!-- 상품이미지,이름 끌어오는중,,, -->
    <img th:src="${productImage}" width="100px">
    <span th:text="${productName}"></span>
    <hr>
    <div class="star_div">
      <div>
        <span>상품에 만족하셨나요?</span><br>
        <i class="star fa fa-star-o" aria-hidden="true" data-jumsu="1" id="star1" title="1점"></i>
        <i class="star fa fa-star-o" aria-hidden="true" data-jumsu="2" id="star2" title="2점"></i>
        <i class="star fa fa-star-o" aria-hidden="true" data-jumsu="3" id="star3" title="3점"></i>
        <i class="star fa fa-star-o" aria-hidden="true" data-jumsu="4" id="star4" title="4점"></i>
        <i class="star fa fa-star-o" aria-hidden="true" data-jumsu="5" id="star5" title="5점"></i>
      </div>
    </div>
    <hr>
    <textarea placeholder="상품평을 남겨 주세요" id="content"></textarea>
    <div>
      <button id="write" class="btn btn-primary">작성</button>
    </div>
  </section>
</main>
<footer th:replace="~{/fragment/footer.html}">
</footer>
</body>
</html>