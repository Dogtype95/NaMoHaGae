<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        function sample4_execDaumPostcode() {
            new daum.Postcode({
                oncomplete : function(data) {
                    var roadAddr = data.roadAddress;
                    var extraRoadAddr = '';

                    if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)) {
                        extraRoadAddr += data.bname;
                    }
                    if (data.buildingName !== '' && data.apartment === 'Y') {
                        extraRoadAddr += (extraRoadAddr !== '' ? ', '	+ data.buildingName : data.buildingName);
                    }
                    if (extraRoadAddr !== '') {
                        extraRoadAddr = ' (' + extraRoadAddr + ')';
                    }

                    document.getElementById('sample4_postcode').value = data.zonecode;
                    document.getElementById("sample4_roadAddress").value = roadAddr;
                    document.getElementById("sample4_jibunAddress").value = data.jibunAddress;

                    if (roadAddr !== '') {
                        document.getElementById("sample4_extraAddress").value = extraRoadAddr;
                    } else {
                        document.getElementById("sample4_extraAddress").value = '';
                    }

                    var guideTextBox = document.getElementById("guide");
                    if (data.autoRoadAddress) {
                        var expRoadAddr = data.autoRoadAddress + extraRoadAddr;
                        guideTextBox.innerHTML = '(예상 도로명 주소 : ' + expRoadAddr + ')';
                        guideTextBox.style.display = 'block';
                    } else if (data.autoJibunAddress) {
                        var expJibunAddr = data.autoJibunAddress;
                        guideTextBox.innerHTML = '(예상 지번 주소 : '		+ expJibunAddr + ')';
                        guideTextBox.style.display = 'block';
                    } else {
                        guideTextBox.innerHTML = '';
                        guideTextBox.style.display = 'none';
                    }
                }
            }).open();

        }



        const apiUrl = 'https://dapi.kakao.com/v2/local/search/address.json';
        const headers = { 'Authorization': 'KakaoAK 3aebe1c5743b1fcc93a6bfb52e8ff445' };
        const address = document.getElementById("sample4_roadAddress").value;

        function location(){

        fetch(`${apiUrl}?query=${encodeURIComponent(address)}`, { headers })
            .then(response => response.json())
            .then(data => {
                // API에서 반환된 데이터 처리
                const latitude = data.documents[0].road_address.x;
                const longitude = data.documents[0].road_address.y;
                const dong = data.documents[0].address.region_3depth_name;
                console.log(dong);
                console.log(longitude);
                console.log(latitude);
                alert(dong);
                alert(longitude);
                alert(latitude);
               const dong1 = document.getElementById("memberDong").value = dong;
               const  longitude1 = document.getElementById("memberLatitude").value = longitude;
               const latitude1= document.getElementById("memberLongitude").value = latitude;
                address2.add(dong1);
                address2.add(longitude1);
                address2.add(latitude1);

            })
            .catch(error => {
                // 발생 가능한 모든 오류 처리
                console.error(error);
            });
        }



    </script>

    <title>회원 가입</title>
</head>
<body>
<div id="page">
    <header th:replace="~{/fragment/header.html}"> </header>
    <nav th:replace="~{/fragment/nav.html}"></nav>
    <main>
        <aside th:replace="~{/fragment/aside.html}"></aside>
        <section>
            <h1>회원 가입</h1>
            <form id="join_form" method="post" action="/member/join" enctype="multipart/form-data">

                <div class="mb-3 mt-3">
                    <label for="memberEmail">이메일:</label>
                    <input type="text" name="memberEmail" id="memberEmail" class="form-control">
                    <span id="memberEmail_msg"></span>
                </div>
                <div class="mb-3 mt-3">
                    <label for="memberPassword">비밀번호:</label>
                    <input type="password" name="memberPassword" id="memberPassword" class="form-control">
                    <span id="memberPassword_msg"></span>
                </div>

                <div class="mb-3 mt-3">
                    <label for="memberNickname">별명:</label>
                    <input type="text" name="memberNickname" id="memberNickname" class="form-control" maxlength="10">
                    <span id="memberNickname_msg"></span>
                </div>
                <div class="mb-3 mt-3">
                    <label for="memberPhone">연락처:</label>
                    <input type="text" name="memberPhone" id="memberPhone" class="form-control" maxlength="10">
                    <span id="memberPhone_msg"></span>
                </div>
                <div class="mb-3 mt-3">
                        <div class="mb-3 mt-3">
                            <input type="text" class="form-control" id="sample4_postcode" placeholder="우편번호" name="zipcode">
                            <input type="button" class="btn btn-outline-primary" onclick="sample4_execDaumPostcode()" value="우편번호 찾기">
                        </div>
                        <div class="mb-3 mt-3">
                            <input type="text" class="form-control" id="sample4_roadAddress" placeholder="도로명주소" name="address1">
                        </div>
                        <input type="text" id="sample4_jibunAddress" placeholder="지번주소" style="display:none;">
                        <span id="guide" style="color: #999; display: none"></span>
                        <div class="mb-3 mt-3">
                            <input type="text" class="form-control" id="sample4_detailAddress" placeholder="상세주소" name="address2">
                        </div>
                        <input type="text" id="sample4_extraAddress" placeholder="참고항목" style="display:none;">
                </div>
                    <input type="hidden" id="memberLatitude" name="memberLatitude">
                    <input type="hidden" id="memberLongitude" name="memberLongitude">
                    <input type="hidden" id="memberDong" name="memberDong">
                <div class="mb-3 mt-3 d-grid">
                    ]<button type="button" onclick="location()">Check Values</button>
                    <button id="join" type="submit" class="btn btn-primary btn-block">가입</button>
                </div>
            </form>
        </section>
        <button id="check">주소 확인</button>

    </main>
    <footer th:replace="~{/fragment/footer.html}"> </footer>
</div>
</body>
</html>
