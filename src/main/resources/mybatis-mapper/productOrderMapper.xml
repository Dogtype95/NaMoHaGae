<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.kro.namohagae.mall.dao.ProductOrderDao">
    <!-- 주문 상세 저장 -->
    <insert id="save">
        <selectKey keyProperty="productOrderNo" order="BEFORE" resultType="int">
            select product_order_seq_product_order_no.nextval from dual
        </selectKey>
        insert into PRODUCT_ORDER (product_order_no,member_no,address_no,product_order_total_price,product_order_date)
        values (#{productOrderNo},#{memberNo},#{addressNo},#{productOrderTotalPrice},#{productOrderDate})
    </insert>

    <resultMap id="readMap" type="kr.kro.namohagae.mall.dto.ProductOrderDto$Read">
        <result property="product_order_no" column="productOrderNo" />
        <result property="member_no" column="memberNo" />
        <result property="address_no" column="addressNo" />
        <result property="product_order_total_price" column="productOrderTotalPrice" />
        <result property="product_order_date" column="productOrderDate" />
        <collection property="orderDetailList" javaType="list" ofType="productOrderDetail">
            <result property="product_order_detail_no" column="productOrderDetailNo" />
            <result property="product_order_detail_count" column="productOrderDetailCount" />
            <result property="product_order_detail_price" column="productOrderDetailPrice" />
            <result property="product_order_detail_review_enabled" column="productOrderDetailReviewEnabled" />
        </collection>
    </resultMap>

    <!-- 주문 목록 보기 -->
    <select id="list" resultMap="readMap">
        select o.product_order_no, o.member_no, o.address_no, o.product_order_total_price, o.product_order_date,
               od.product_order_detail_no, od.product_order_detail_count, od.product_order_detail_price, od.product_order_detail_review_enabled
        from PRODUCT_ORDER o join PRODUCT_ORDER_DETAIL od on o.product_order_no = od.product_order_no
        where o.product_order_no=#{productOrderNo} and rownum=1
    </select>

    <!-- 주문 상세 보기 -->
    <select id="read" resultMap="readMap">
        select o.product_order_no, o.member_no, o.address_no, o.product_order_total_price, o.product_order_date,
               od.product_order_detail_no, od.product_order_detail_count, od.product_order_detail_price
        from PRODUCT_ORDER o join PRODUCT_ORDER_DETAIL od on o.product_order_no = od.product_order_no
        where o.product_order_no=#{productOrderNo} and rownum=1
    </select>
</mapper>