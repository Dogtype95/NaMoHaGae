<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.kro.namohagae.mall.dao.CartDao">
    <!-- 장바구니에 저장 -->
    <insert id="save">
        <selectKey keyProperty="cartNo" order="BEFORE" resultType="int">
            select cart_seq_cart_no.nextval from dual
        </selectKey>
        insert into CART(cart_no,member_no,cart_total_price)
        values(#{cartNo},#{memberNo},#{cartTotalPrice})
    </insert>

    <!-- 해당 사용자의 장바구니 찾기 -->
    <select id="findByMemberNo" resultType="Cart">
        select * from CART where member_no = #{memberNo}
    </select>

    <!-- 장바구니 총 가격 업데이트 -->
    <update id="updateTotalPrice" parameterType="Cart">
        update CART set cart_total_price = #{cartTotalPrice}
        where cart_no = #{cartNo} and member_no = #{memberNo}
    </update>

    <!-- 장바구니에서 삭제 -->
    <delete id="deleteByCartNoAndMemberNo">
        delete from CART where cart_no = #{cartNo} and member_no = #{memberNo}
    </delete>

    <!-- 주문 완료 후 장바구니에서 상품 삭제 -->
    <delete id="removeByCartNo" parameterType="int">
        delete from CART_DETAIL where cart_no = #{cartNo}
    </delete>

    <!-- 장바구니 번호로 장바구니 검색 -->
    <select id="findByCartNoAndMemberNo" parameterType="int" resultType="Cart">
        select * from CART where cart_no = #{cartNo} and member_no = #{memberNo}
    </select>

    <!-- 사용자의 장바구니 상품 총 개수 검색 -->
    <select id="findCountByMemberNo" parameterType="int" resultType="int">
        select count(*) from CART_DETAIL where member_no = #{memberNo}
    </select>

    <!-- 사용자의 장바구니 상품 목록 검색 -->
    <select id="findCartDetailsByMemberNo" resultType="CartDetail">
        select * from CART_DETAIL where member_no = #{memberNo}
    </select>

    <!-- 사용자의 장바구니 상품 총 가격 검색 -->
    <select id="findTotalPriceByMemberNo" parameterType="int" resultType="int">
        select sum(cart_detail_price) as cart_total_price from CART_DETAIL where member_no = #{memberNo}
    </select>
</mapper>